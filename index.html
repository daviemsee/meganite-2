<script type="module">
  // Firebase v9 Modular Syntax
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCA4dxfOiSKodT-lQ1EV_8bC7psStgluIU",
    authDomain: "meganite-aa244.firebaseapp.com",
    projectId: "meganite-aa244",
    storageBucket: "meganite-aa244.appspot.com",
    messagingSenderId: "327064488928",
    appId: "1:327064488928:web:005b163d4c1fbdf993b985",
    measurementId: "G-Z5SYFM29C0"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  window.login = async function () {
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;
    try {
      await signInWithEmailAndPassword(auth, email, pass);
      document.getElementById('auth-section').classList.add('hidden');
      document.getElementById('packages').classList.remove('hidden');
      loadTasks('silver');
    } catch (error) {
      alert(error.message);
    }
  }

  window.signup = async function () {
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;
    try {
      await createUserWithEmailAndPassword(auth, email, pass);
      login();
    } catch (error) {
      alert(error.message);
    }
  }

  async function loadTasks(packageName) {
    const docRef = doc(db, "packages", packageName);
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
      const data = docSnap.data();
      const container = document.getElementById("package-list");
      container.innerHTML = "";
      data.currentTasks.forEach(task => {
        const div = document.createElement("div");
        div.className = "package";
        div.innerHTML = `<strong>${task.name}</strong><br><a href="${task.apkUrl}" download>Download</a>`;
        container.appendChild(div);
      });
    } else {
      console.log("No such package found!");
    }
  }
</script>
